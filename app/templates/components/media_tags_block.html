{# Partial: media tags + unified add-tag picker (HA-like) for media detail page #}
<div id="media-tags-block">
  {% include "components/media_tags.html" %}

  <form class="d-flex flex-wrap gap-1 align-center mb-2"
        method="POST"
        action="/media/{{ item.id }}/tags"
        hx-post="/media/{{ item.id }}/tags"
        hx-target="#media-tags"
        hx-swap="outerHTML">
    <div class="tag-picker" data-tag-picker data-post-url="/media/{{ item.id }}/tags">
      <input type="search"
             name="tag"
             class="form-control form-control-sm"
             style="width:100%;min-width:320px;max-width:680px;padding:6px 10px;font-size:0.85rem;"
             placeholder="Ajouter une étiquette…"
             autocomplete="off"
             data-tag-picker-input
             aria-label="Ajouter une étiquette"
             {% if not available_tag_options or available_tag_options|length == 0 %}disabled{% endif %}>

      <div class="tag-picker-menu" data-tag-picker-menu hidden></div>
      <script type="application/json" data-tag-picker-options>{{ available_tag_options | tojson }}</script>
      <script type="application/json" data-tag-picker-color-map>{
        {% for slug, label in cat_labels.items() if cat_colors.get(slug) %}
        {{ label | tojson }}: {{ cat_colors.get(slug) | tojson }}{% if not loop.last %},{% endif %}
        {% endfor %}
      }</script>
    </div>
  </form>

  {% if not available_tag_options or available_tag_options|length == 0 %}
  <div class="text-muted text-sm" style="margin-top:-6px;margin-bottom:10px;">
    Tous les tags existants sont déjà appliqués.
  </div>
  {% endif %}
</div>
